<div class="space-y-8">
  <div>
    <h2 class="text-xl font-semibold text-gray-900">User Profile</h2>
    <p class="mt-1 text-sm text-gray-500">Your account information and connected services.</p>
  </div>

  <!-- User Profile Card -->
  <div class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-2xl p-1">
    <div class="bg-white rounded-xl p-6">
      <div class="flex items-center space-x-6">
        <div class="flex-shrink-0">
          <div class="h-20 w-20 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-2xl font-bold shadow-lg">
            <%= user.name ? user.name.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase() %>
          </div>
        </div>
        <div class="flex-1 min-w-0">
          <h3 class="text-xl font-bold text-gray-900 truncate"><%= user.name || 'User' %></h3>
          <p class="text-sm text-gray-500"><%= user.email %></p>
          <div class="mt-2 flex items-center space-x-2">
            <span class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-800">
              <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3"/></svg>
              Active
            </span>
            <span class="text-xs text-gray-400">Member since <%= new Date(user.createdAt).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) %></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Update profile form -->
  <div class="bg-white rounded-2xl border border-gray-200 p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Update your profile</h3>
    <form method="POST" action="/profile" class="space-y-4 max-w-md">
      <div>
        <label for="profile-name" class="block text-sm font-medium text-gray-700">Display name</label>
        <input
          type="text"
          id="profile-name"
          name="name"
          value="<%= user.name || '' %>"
          placeholder="Your name"
          class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm"
          required
        />
        <p class="mt-1 text-xs text-gray-500">This name appears in the header and on your profile.</p>
      </div>
      <div>
        <p class="text-sm text-gray-500">Email: <span class="font-medium text-gray-700"><%= user.email %></span></p>
        <p class="text-xs text-gray-400">Email cannot be changed here. Contact support if you need to update it.</p>
      </div>
      <button
        type="submit"
        class="inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
      >
        Save changes
      </button>
    </form>
  </div>

  <!-- Connected Calendars -->
  <div class="space-y-4">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold text-gray-900">Connected Calendars</h3>
      <% 
        // Count only connected calendars
        const connectedCalendars = calendars.filter(function(cal) {
          const status = cal.status || cal.recallData?.status;
          return status === 'connected';
        });
      %>
      <span class="inline-flex items-center rounded-full bg-indigo-100 px-3 py-1 text-xs font-medium text-indigo-700">
        <%= connectedCalendars.length %> connected
      </span>
    </div>
    
    <div class="space-y-3">
      <% calendars.forEach(function(cal) { 
        const calStatus = cal.status || cal.recallData?.status;
        const isDisconnected = calStatus === 'disconnected';
      %>
      <div class="bg-white rounded-xl border <%= isDisconnected ? 'border-red-200 bg-red-50/30' : 'border-gray-200' %> p-4 hover:shadow-md transition-shadow">
        <% if (isDisconnected) { %>
        <div class="mb-3 flex items-start space-x-2 text-sm text-red-700 bg-red-50 rounded-lg p-2">
          <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
          </svg>
          <div>
            <p class="font-medium">Connection broken</p>
            <p class="text-xs text-red-600">Please reconnect your calendar to continue receiving meeting recordings.</p>
          </div>
        </div>
        <% } %>
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <% if (cal.platform === 'google_calendar') { %>
              <div class="flex-shrink-0 w-12 h-12 bg-white rounded-xl shadow-sm flex items-center justify-center">
                <img class="h-8 w-8" src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Google_Calendar_icon_%282020%29.svg/2048px-Google_Calendar_icon_%282020%29.svg.png" alt="Google Calendar" />
              </div>
            <% } else { %>
              <div class="flex-shrink-0 w-12 h-12 bg-white rounded-xl shadow-sm flex items-center justify-center">
                <img class="h-8 w-8" src="https://img.icons8.com/color/480/outlook-calendar.png" alt="Outlook" />
              </div>
            <% } %>
            <div>
              <p class="text-sm font-semibold text-gray-900"><%= cal.email %></p>
              <p class="text-xs text-gray-500"><%= cal.platform === 'google_calendar' ? 'Google Calendar' : 'Microsoft Outlook' %></p>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <%- include('calendar-status-badge', {status: calStatus}) %>
            <% if (cal.recallId && calStatus !== 'disconnected') { %>
              <form method="post" action="/calendar/<%= cal.id %>/disconnect" class="inline">
                <button 
                  type="submit" 
                  class="inline-flex items-center text-sm font-medium text-orange-600 hover:text-orange-500"
                  title="Disconnect calendar"
                  onclick="return confirm('Are you sure you want to disconnect this calendar? You can reconnect it later.')"
                >
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path>
                  </svg>
                  Disconnect
                </button>
              </form>
            <% } else if (isDisconnected) { %>
              <a href="/" class="inline-flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-500">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Reconnect
              </a>
            <% } %>
            <a href="/calendar/<%= cal.id %>" class="text-indigo-600 hover:text-indigo-500 text-sm font-medium">
              Manage →
            </a>
          </div>
        </div>
      </div>
      <% }); %>
    </div>

    <div class="flex flex-wrap gap-3 mt-3">
      <a href="<%= connectUrls?.googleCalendar %>" class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-500 font-medium bg-indigo-50 hover:bg-indigo-100 px-3 py-2 rounded-lg transition-colors">
        <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12.545 10.239v3.821h5.445c-.712 2.315-2.647 3.972-5.445 3.972a6.033 6.033 0 110-12.064c1.498 0 2.866.549 3.921 1.453l2.814-2.814A9.969 9.969 0 0012.545 2C7.021 2 2.543 6.477 2.543 12s4.478 10 10.002 10c8.396 0 10.249-7.85 9.426-11.748l-9.426-.013z"/>
        </svg>
        Add Google Calendar
      </a>
      <a href="<%= connectUrls?.microsoftOutlook %>" class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-500 font-medium bg-indigo-50 hover:bg-indigo-100 px-3 py-2 rounded-lg transition-colors">
        <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7.88 12.04q0 .45-.11.87-.1.41-.33.74-.22.33-.58.52-.37.2-.87.2t-.85-.2q-.35-.21-.57-.55-.22-.33-.33-.75-.1-.42-.1-.86t.1-.87q.1-.43.34-.76.22-.34.59-.54.36-.2.87-.2t.86.2q.35.21.57.55.22.34.31.77.1.43.1.88zM24 12v9.38q0 .46-.33.8-.33.32-.8.32H7.13q-.46 0-.8-.33-.32-.33-.32-.8V18H1q-.41 0-.7-.3-.3-.29-.3-.7V7q0-.41.3-.7Q.58 6 1 6h6.5V2.55q0-.44.3-.75.3-.3.75-.3h12.9q.44 0 .75.3.3.3.3.75V12zm-6-8.25v3h3v-3zm0 4.5v3h3v-3zm0 4.5v1.83l3.05-1.83zm-5.25-9v3h3.75v-3zm0 4.5v3h3.75v-3zm0 4.5v2.03l2.41 1.5 1.34-.8v-2.73zM9 3.75V6h2l.13.01.12.04v-2.3zM5.98 15.98q.9 0 1.6-.3.7-.32 1.19-.86.48-.55.73-1.28.25-.74.25-1.61 0-.83-.25-1.55-.24-.71-.71-1.24t-1.15-.83q-.68-.3-1.55-.3-.92 0-1.64.3-.71.3-1.2.85-.5.54-.75 1.3-.25.74-.25 1.63 0 .85.26 1.56.26.72.74 1.23.48.52 1.17.81.69.3 1.56.3zM7.5 21h12.39L12 16.08V17q0 .41-.3.7-.29.3-.7.3H7.5zm15-.13v-7.24l-5.9 3.54Z"/>
        </svg>
        Add Microsoft Outlook
      </a>
    </div>
  </div>

  <!-- Connected Integrations -->
  <div class="space-y-4">
    <h3 class="text-lg font-semibold text-gray-900">Integrations</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Notion Integration -->
      <div class="bg-white rounded-xl border border-gray-200 p-5 hover:shadow-md transition-shadow">
        <div class="flex items-start space-x-4">
          <div class="flex-shrink-0 w-12 h-12 bg-gray-900 rounded-xl flex items-center justify-center">
            <svg class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="currentColor">
              <path d="M4.459 4.208c.746.606 1.026.56 2.428.466l13.215-.793c.28 0 .047-.28-.046-.326L17.86 1.968c-.42-.326-.98-.7-2.055-.607L3.01 2.295c-.466.046-.56.28-.374.466zm.793 3.08v13.904c0 .747.373 1.027 1.214.98l14.523-.84c.841-.046.935-.56.935-1.167V6.354c0-.606-.233-.933-.748-.887l-15.177.887c-.56.047-.747.327-.747.934zm14.337.745c.093.42 0 .84-.42.888l-.7.14v10.264c-.608.327-1.168.514-1.635.514-.748 0-.935-.234-1.495-.933l-4.577-7.186v6.952l1.448.327s0 .84-1.168.84l-3.22.186c-.094-.186 0-.653.327-.746l.84-.233V9.854L7.822 9.62c-.094-.42.14-1.026.793-1.073l3.454-.233 4.764 7.28v-6.44l-1.215-.14c-.093-.514.28-.887.747-.933zM2.212 1.107l13.028-.933c1.635-.14 2.055-.047 3.08.7l4.249 2.986c.7.514.934.653.934 1.213v16.378c0 1.026-.373 1.634-1.68 1.726l-15.458.934c-.98.047-1.448-.093-1.962-.747l-3.129-4.06c-.56-.747-.793-1.306-.793-1.96V2.667c0-.839.374-1.54 1.73-1.56z"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="flex items-center justify-between">
              <h4 class="text-sm font-semibold text-gray-900">Notion</h4>
              <% if (notionDestination) { %>
                <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">
                  Connected
                </span>
              <% } else { %>
                <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600">
                  Not connected
                </span>
              <% } %>
            </div>
            <p class="text-xs text-gray-500 mt-1">Auto-publish meeting notes to Notion</p>
            <% if (notionDestination) { %>
              <p class="text-xs text-gray-600 mt-2 truncate">
                Publishing to: <span class="font-medium"><%= notionDestination.pageName || notionDestination.pageId %></span>
              </p>
            <% } else { %>
              <a href="/oauth/notion" class="inline-flex items-center text-xs text-indigo-600 hover:text-indigo-500 font-medium mt-2">
                Connect Notion →
              </a>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Future Integration Placeholder -->
      <div class="bg-gray-50 rounded-xl border-2 border-dashed border-gray-200 p-5 flex items-center justify-center">
        <div class="text-center">
          <svg class="mx-auto h-10 w-10 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          <p class="mt-2 text-sm text-gray-400">More integrations coming soon</p>
        </div>
      </div>
    </div>
  </div>
</div>
