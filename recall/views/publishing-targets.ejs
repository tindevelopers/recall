<%- include('partials/header') -%>
<div class="min-h-full">
  <%- include('partials/navigation', { user: user, currentPage: 'settings' }) -%>
  <%- include('partials/notice', { notice: notice }) -%>
  <div class="py-10">
    <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 space-y-6">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Publishing Targets</h1>
        <p class="text-sm text-gray-500">Manage where meeting summaries are sent and review recent publishes.</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-white shadow sm:rounded-lg p-4">
          <h2 class="text-base font-semibold text-gray-900 mb-3">Integrations</h2>
          <ul class="space-y-2 text-sm">
            <% integrations.forEach(intg => { %>
              <li class="flex items-center justify-between border border-gray-100 rounded-md px-3 py-2">
                <div>
                  <p class="font-medium capitalize"><%= intg.provider %></p>
                  <p class="text-gray-500 text-xs">Token stored</p>
                </div>
                <% if (intg.provider === 'slack') { %>
                  <a href="/oauth/slack" class="text-indigo-600 text-xs hover:text-indigo-500">Reconnect</a>
                <% } %>
              </li>
            <% }); %>
            <% if (!integrations.length) { %>
              <li class="text-gray-500 text-xs">No integrations connected.</li>
            <% } %>
          </ul>
          <div class="mt-3 text-xs text-gray-600">
            <p>Configure targets in Settings → Publishing.</p>
          </div>
        </div>

        <div class="bg-white shadow sm:rounded-lg p-4">
          <h2 class="text-base font-semibold text-gray-900 mb-3">Targets</h2>
          <ul class="space-y-2 text-sm">
            <% targets.forEach(t => { %>
              <li class="flex items-center justify-between border border-gray-100 rounded-md px-3 py-2">
                <div>
                  <p class="font-medium capitalize"><%= t.type %></p>
                  <p class="text-gray-500 text-xs truncate">Config: <%= JSON.stringify(t.config || {}) %></p>
                </div>
                <span class="text-xs <%= t.enabled ? 'text-green-600' : 'text-gray-500' %>"><%= t.enabled ? 'Enabled' : 'Disabled' %></span>
              </li>
            <% }); %>
            <% if (!targets.length) { %>
              <li class="text-gray-500 text-xs">No targets configured.</li>
            <% } %>
          </ul>
          <div class="mt-3 text-xs text-gray-600">
            <a href="/settings" class="text-indigo-600 hover:text-indigo-500">Go to Settings to configure</a>
          </div>
        </div>
      </div>

      <div class="bg-white shadow sm:rounded-lg p-4">
        <h2 class="text-base font-semibold text-gray-900 mb-3">Recent Publishes</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="text-left text-gray-500">
                <th class="py-2 pr-4">Target</th>
                <th class="py-2 pr-4">Status</th>
                <th class="py-2 pr-4">URL</th>
                <th class="py-2 pr-4">Created</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              <% deliveries.forEach(d => { %>
                <tr>
                  <td class="py-2 pr-4 capitalize"><%= d.PublishTarget?.type || 'unknown' %></td>
                  <td class="py-2 pr-4">
                    <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium <%= d.status === 'success' ? 'bg-green-50 text-green-700' : d.status === 'failed' ? 'bg-red-50 text-red-700' : 'bg-yellow-50 text-yellow-700' %>">
                      <%= d.status %>
                    </span>
                  </td>
                  <td class="py-2 pr-4">
                    <% if (d.url) { %>
                      <a class="text-indigo-600 hover:text-indigo-500 underline" href="<%= d.url %>" target="_blank" rel="noopener">Open</a>
                    <% } else { %>
                      <span class="text-gray-400">—</span>
                    <% } %>
                  </td>
                  <td class="py-2 pr-4 text-gray-500"><%= d.createdAt.toISOString() %></td>
                </tr>
              <% }); %>
              <% if (!deliveries.length) { %>
                <tr><td colspan="4" class="py-3 text-gray-500">No deliveries yet.</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<%- include('partials/footer') -%>


